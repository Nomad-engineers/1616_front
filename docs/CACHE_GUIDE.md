# –°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π localStorage –∏ –º–µ—Ö–∞–Ω–∏–∑–º–æ–º stale-while-revalidate.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. ApiCache (`lib/cache.ts`)

–ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—ç—à–µ–º —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- **localStorage** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
- **TTL (Time To Live)** - 5 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** –∏—Å—Ç–µ–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
- **Singleton –ø–∞—Ç—Ç–µ—Ä–Ω** –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

```typescript
import { apiCache } from '@/lib/cache'

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
apiCache.set('key', data, 5 * 60 * 1000) // 5 –º–∏–Ω—É—Ç

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞
const data = apiCache.get('key')

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è
if (apiCache.has('key')) { /* ... */ }

// –û—á–∏—Å—Ç–∫–∞
apiCache.clear()
```

### 2. CachedApiClient (`lib/cached-api-client.ts`)

–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π API –∫–ª–∏–µ–Ω—Ç —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

```typescript
import { cachedApiClient } from '@/lib/cached-api-client'

// GET –∑–∞–ø—Ä–æ—Å —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
const data = await cachedApiClient.get('/api/data', params, {
  enabled: true,
  ttl: 5 * 60 * 1000,
  key: 'custom-key'
})

// POST –∑–∞–ø—Ä–æ—Å (–±–µ–∑ –∫—ç—à–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
await cachedApiClient.post('/api/data', postData)
```

### 3. useCachedPageData Hook (`hooks/use-cached-page-data.ts`)

React —Ö—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü:

```typescript
import { useCachedPageData } from '@/hooks/use-cached-page-data'

const {
  data,
  loading,
  error,
  isFromCache,
  isValidating,
  cacheStatus,
  refetch
} = useCachedPageData('home', {
  staleWhileRevalidate: true
})
```

### 4. CacheControls (`components/ui/cache-controls.tsx`)

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—ç—à–µ–º –≤ development —Ä–µ–∂–∏–º–µ:
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π –≤ –∫—ç—à–µ
- –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
- –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
- –û—á–∏—Å—Ç–∫–∞ localStorage

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Stale-While-Revalidate

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
1. **–° –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–º –ø–æ–∫–∞–∑–æ–º** –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫—ç—à–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
2. **–§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –¥–∞–Ω–Ω—ã—Ö fresh –≤–µ—Ä—Å–∏–µ–π
3. **–ü–ª–∞–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** UI –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### localStorage –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- –ö—ç—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage –ø–æ–¥ –∫–ª—é—á–æ–º `api-cache-v1`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö localStorage

### TTL –º–µ—Ö–∞–Ω–∏–∑–º

- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **5 –º–∏–Ω—É—Ç** (300,000 –º—Å)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏
- –§–æ–Ω–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

### –ü—Ä–∏–º–µ—Ä –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü:

```typescript
// app/example-page/page.tsx
'use client'

import { useCachedPageData } from '@/hooks/use-cached-page-data'

export default function ExamplePage() {
  const { data, loading, isFromCache, refetch } = useCachedPageData('example', {
    staleWhileRevalidate: true
  })

  if (loading && !isFromCache) return <div>Loading...</div>

  return (
    <div>
      {isFromCache && <div>üì¶ Data from cache</div>}
      {/* –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã */}
      <button onClick={() => refetch(true)}>Force Refresh</button>
    </div>
  )
}
```

### –ü—Ä–∏–º–µ—Ä –¥–ª—è API:

```typescript
// api/example/index.ts
import { cachedApiClient } from '@/lib/cached-api-client'

export class ExampleApi {
  async getAll(params?: any) {
    return await cachedApiClient.get<ExampleData[]>('/api/examples', params, {
      ttl: 10 * 60 * 1000, // 10 –º–∏–Ω—É—Ç
      key: 'examples-list'
    })
  }

  async getById(id: string) {
    return await cachedApiClient.get<ExampleData>(`/api/examples/${id}`, undefined, {
      ttl: 5 * 60 * 1000, // 5 –º–∏–Ω—É—Ç
      key: `example-${id}`
    })
  }

  async create(data: CreateExampleData) {
    // POST –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ç–∏—Ä—É—é—Ç –∫—ç—à
    return await cachedApiClient.post<ExampleData>('/api/examples', data)
  }
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫—ç—à–∞:
- `üì¶ Cache hit` - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –∫—ç—à–∞
- `üöÄ Cache miss` - –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ –∫—ç—à–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å
- `üíæ Cached data` - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –∫—ç—à
- `üîÑ Restored cache entry` - –¥–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ localStorage
- `‚è∞ Cache expired` - —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫—ç—à–∞ –∏—Å—Ç–µ–∫

### Development –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **CacheControls** - –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—ç—à–µ–º (—Ç–æ–ª—å–∫–æ –≤ dev —Ä–µ–∂–∏–º–µ)
- **DevCacheIndicator** - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫—ç—à–∞
- **React DevTools** - –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –î–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
- –ö–∞–∂–¥—ã–π –ø–µ—Ä–µ—Ö–æ–¥/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Üí –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å
- –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–æ—Å–µ—â–µ–Ω–∏–∏

### –ü–æ—Å–ª–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–∫–∞–∑** –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ –∫—ç—à–∞
- **–§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI
- **Reduced server load** –Ω–∞ 80-90%
- **Offline capability** –¥–ª—è —Ä–∞–Ω–µ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
NEXT_PUBLIC_CMS_API_URL=https://your-api.com
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TTL:

```typescript
// –ì–ª–æ–±–∞–ª—å–Ω–æ
const client = new CachedApiClient({
  defaultCacheTime: 10 * 60 * 1000 // 10 –º–∏–Ω—É—Ç
})

// –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
await client.get('/api/data', params, {
  ttl: 2 * 60 * 1000 // 2 –º–∏–Ω—É—Ç—ã
})
```

## Best Practices

1. **–î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö** - –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π TTL (15-60 –º–∏–Ω—É—Ç)
2. **–î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö** - –∫–æ—Ä–æ—Ç–∫–∏–π TTL (1-5 –º–∏–Ω—É—Ç)
3. **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö** - –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–π TTL (30 —Å–µ–∫—É–Ω–¥)
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ stale-while-revalidate** –¥–ª—è –ª—É—á—à–µ–≥–æ UX
5. **–û—á–∏—â–∞–π—Ç–µ –∫—ç—à** –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –º—É—Ç–∞—Ü–∏–∏
6. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞** –≤ production

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ö—ç—à –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ localStorage –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TTL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
- –£–≤–µ–ª–∏—á—å—Ç–µ —á–∞—Å—Ç–æ—Ç—É —Ñ–æ–Ω–æ–≤–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `refetch(true)` –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ localStorage
- –£–º–µ–Ω—å—à–∏—Ç–µ TTL –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ LRU eviction
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ IndexedDB –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

## Future Enhancements

1. **Request deduplication** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **Background sync** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
3. **Cache warming** - –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
4. **Analytics** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫—ç—à–∞
5. **Service Worker** - –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ offline –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ